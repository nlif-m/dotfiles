#!/bin/sh

#set -xe


# TODO: Add ability to change folder's with command line argument
# TODO: Add ability to change dmenu options by command line argument
# TODO: Add ability to change sort order
folder_with_videos=/home/nlif/Videos/watch_later 
folder_with_videos_for_sed="s/\/home\/nlif\/Videos\/watch_later\///" 

#is_sorted



how=$(printf "last\nsorted" | dmenu -fn "FreeMono-12" -p "Sorted videos or last first?") || exit 1
if [ "$how" = "last" ];
then
selected_video_pre=$(
    find "$folder_with_videos" -type f -printf "%T+ %p\n" | \
        sort -nr | \
        # Delete time marks and leave just basename
        sed 's/\S* \/.*\///' | \
	    dmenu -i -fn "FreeMono-no-20" -l 20) || exit
fi 

if [ "$how" = "sorted" ];
then
    selected_video_pre=$(
        find "$folder_with_videos" -type f| \
            sort -n | \
            # Delete time marks and leave just basename
            sed "$folder_with_videos_for_sed" | \
            sed 's/\S* \/.*\///' | \
            dmenu -i -fn "FreeMono-no-20" -l 20) || exit
fi

selected_video_full_path="$folder_with_videos/$selected_video_pre"

mpv "$selected_video_full_path" && answer=$(printf "save\ndelete" | \
    dmenu -fn "FreeMono-12" -p "What to do with $selected_video_pre ?" -l 2)

if [ "$answer" = "delete" ];
then 
    rm "$selected_video_full_path"
else
    touch "$selected_video_full_path"
fi

exit 0


selected_video_full_path="$folder_with_videos/$selected_video_pre"
